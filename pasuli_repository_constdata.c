#include <stdlib.h>
#include "pasuli_cfg.h"
#include "pasuli_repository.h"

#define ID_AND_LENGTH(ID, L) \
	{                        \
		ID, L, 0             \
	}

#define ID_AND_LENGTH_C(ID, L, V) \
	{                             \
		ID, L, V                  \
	}

#define STD1_VALUES 120
#define DINI_VALUES 121
#define CYLINDER_VALUES 122
#define LEMON_VALUES 123
#define SPHERE_VALUES 124
#define TORUS1_VALUES 125

#define ALL_ONES 255
#define ALL_HALFES 254

// Constants defined so should be divided by 10 to get real (stored) value
#define CONSTANT_TUPLE_10(V1, V2, V3, V4, V5, V6) V1, V2, V3, V4, V5, V6

unsigned char constants_multiplied[] = {
	// STD1
	CONSTANT_TUPLE_10(15, 5, 10, 10, 10, 10),
	// DINI
	CONSTANT_TUPLE_10(10, 2, 0, 0, 0, 0),
	// CYLINDER
	CONSTANT_TUPLE_10(15, 10, 5, 10, 10, 10),
	// LEMON
	CONSTANT_TUPLE_10(20, 10, 0, 0, 0, 0),
	// Sphere
	CONSTANT_TUPLE_10(15, 10, 10, 0, 0, 0),
	// Torus 1
	CONSTANT_TUPLE_10(10, 10, 5, 10, 10, 10),
};

#undef CONSTANT_TUPLE_10

unsigned char id_and_length[][3] = {
	ID_AND_LENGTH_C(PLANE, 1, 0),
	ID_AND_LENGTH_C(BOHEMIAN_DOME_SURFACE, 3, ALL_ONES),
	ID_AND_LENGTH(BOYS_SURFACE, 0),
	ID_AND_LENGTH(CROSS_CUP, 0),
	//
	ID_AND_LENGTH_C(DINI_SURFACE, 2, DINI_VALUES),
	ID_AND_LENGTH(ENNEPER_SURFACE, 0),
	ID_AND_LENGTH(HANDKERCHIEF, 0),
	ID_AND_LENGTH_C(KLEIN_BOTTLE_SURFACE, 3, ALL_ONES),
	//
	ID_AND_LENGTH_C(MOEBIUS_BAND, 1, ALL_ONES),
	ID_AND_LENGTH(MONKEY_SADDLE, 0),
	ID_AND_LENGTH(PLUECKER_CONOID, 0),
	ID_AND_LENGTH(ROMAN_SURFACE, 0),
	//
	ID_AND_LENGTH(SHOE_SURFACE, 0),
	ID_AND_LENGTH(SINE_SURFACE, 0),
	ID_AND_LENGTH(STEINBACH_SCREW, 0),
	ID_AND_LENGTH(WHITNEY_UMBRELLA, 0),
	//
	ID_AND_LENGTH_C(CATENOID, 1, STD1_VALUES),
	ID_AND_LENGTH_C(HELICOID, 1, STD1_VALUES),
	ID_AND_LENGTH_C(PARABOLOID, 2, STD1_VALUES),
	ID_AND_LENGTH_C(HYPERBOLIC_HELICOID, 1, ALL_HALFES),
	//
	ID_AND_LENGTH(FUNNEL, 0),
	ID_AND_LENGTH(TRACTROID, 0),
	ID_AND_LENGTH(CATALANS_SURFACE, 0),
	ID_AND_LENGTH_C(HYPERBOLOID, 2, STD1_VALUES),
	//
	ID_AND_LENGTH(HENNEBERGS_SURFACE, 0),
	ID_AND_LENGTH(SWALLOW_SURFACE, 0),
	ID_AND_LENGTH_C(WALLIS_CONICAL_SURFACE, 3, STD1_VALUES),
	ID_AND_LENGTH(MAEDERS_OWL, 0),
	//
	ID_AND_LENGTH(RICHMOND_SURFACE, 0),
	ID_AND_LENGTH_C(SCHERK_SURFACE, 1, STD1_VALUES),
	ID_AND_LENGTH(COSINE_SURFACE, 0),
	ID_AND_LENGTH(EIGHT_SURFACE, 0),
	//
	ID_AND_LENGTH(JET_SURFACE, 0),
	ID_AND_LENGTH_C(DROP, 2, STD1_VALUES),
	ID_AND_LENGTH(TRIAXIAL_TEARDROP, 0),
	ID_AND_LENGTH_C(PILLOW_SHAPE, 1, STD1_VALUES),
	//
	ID_AND_LENGTH(FISH_SURFACE, 0),
	ID_AND_LENGTH_C(HORN, 3, STD1_VALUES),
	ID_AND_LENGTH(BENT_HORNS, 0),
	ID_AND_LENGTH(HYPERBOLIC_OCTAHEDRON, 0),
	//
	ID_AND_LENGTH(PSEUDO_CROSS_CAP, 0),
	ID_AND_LENGTH_C(CRESENT, 3, STD1_VALUES),
	ID_AND_LENGTH(STILETTO_SURFACE, 0),
	ID_AND_LENGTH(KUENS_SURFACE, 0),
	//
	ID_AND_LENGTH_C(TREFOIL_KNOTS, 2, STD1_VALUES),
	ID_AND_LENGTH(TRANGULOID_TREFOIL, 0),
	ID_AND_LENGTH(CROWN, 0),
	ID_AND_LENGTH(TWISTED_PIPE_SURFACE, 0),
	//
	ID_AND_LENGTH(LOOP, 0),
	ID_AND_LENGTH_C(DUPIN_CYCLIDE, 4, STD1_VALUES),
	ID_AND_LENGTH_C(GUIMARD_SURFACE, 3, STD1_VALUES),
	ID_AND_LENGTH_C(MENNS_SURFACE, 1, ALL_ONES),
	//
	ID_AND_LENGTH_C(MILK_BAG, 1, ALL_ONES),
	ID_AND_LENGTH(TRIAXIAL_TRITORUS, 0),
	ID_AND_LENGTH(VERRILL_SURFACE, 0),
	ID_AND_LENGTH(ZINDLERS_CONOID, 1),
	//
	ID_AND_LENGTH(FOLIUM, 0),
	ID_AND_LENGTH(LEMNISCAPE, 0),
	ID_AND_LENGTH(TRIPLE_POINT_TWIST, 1),
	ID_AND_LENGTH(TRASHCAN, 2),
	//
	ID_AND_LENGTH(SPRING1, 4),
	ID_AND_LENGTH(SPRING2, 3),
	ID_AND_LENGTH_C(CONE, 1, ALL_ONES),
	ID_AND_LENGTH(EGG, 3),
	//
	ID_AND_LENGTH_C(ISOLATOR, 3, STD1_VALUES),
	ID_AND_LENGTH(HYPERBOLIC_PARABOLOID, 0),
	ID_AND_LENGTH_C(FACING_SNAIL, 1, STD1_VALUES),
	ID_AND_LENGTH_C(PAPER_BAG, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(JEENER_KLEIN_SURFACE, 3, STD1_VALUES),
	ID_AND_LENGTH_C(BONAN_JEENER_KLEIN_SURFACE, 2, STD1_VALUES),
	ID_AND_LENGTH_C(KLEIN_CYCLOID, 3, STD1_VALUES),
	ID_AND_LENGTH(DOUBLE_CONE, 0),
	//
	ID_AND_LENGTH(HOLE_DISC, 0),
	ID_AND_LENGTH(PISOT_TRIAXIAL, 0),
	ID_AND_LENGTH(TRIAXIAL_HEXATORUS, 0),
	ID_AND_LENGTH(TWISTED_HEART, 0),
	//
	ID_AND_LENGTH_C(HOLE_DISCUS, 2, STD1_VALUES),
	ID_AND_LENGTH(DISC, 0),
	ID_AND_LENGTH_C(WAVES, 3, STD1_VALUES),
	ID_AND_LENGTH_C(SINE_WAVE, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(COSINE_WAVE, 2, STD1_VALUES),
	ID_AND_LENGTH_C(SPIRAL_WAVE, 3, STD1_VALUES),
	ID_AND_LENGTH_C(BELL, 2, STD1_VALUES),
	ID_AND_LENGTH_C(BELL_POLAR, 3, STD1_VALUES),
	//
	ID_AND_LENGTH_C(BELL_WAVE, 3, STD1_VALUES),
	ID_AND_LENGTH(SOUCOUPOID, 0),
	ID_AND_LENGTH(ENNEPER_SURFACE_POLAR, 0),
	ID_AND_LENGTH_C(SINE_CONE, 2, STD1_VALUES),
	//
	ID_AND_LENGTH(SPINNER, 0),
	ID_AND_LENGTH_C(FRESNEL, 3, STD1_VALUES),
	ID_AND_LENGTH_C(TREFOIL_KNOTS2, 4, STD1_VALUES),
	ID_AND_LENGTH_C(BOW_CURVE, 1, STD1_VALUES),
	//
	ID_AND_LENGTH_C(TRIPLE_CORK_SCREW1, 4, STD1_VALUES),
	ID_AND_LENGTH_C(TRIPLE_CORK_SCREW2, 6, STD1_VALUES),
	ID_AND_LENGTH_C(TRIPLE_CORK_SCREW3, 4, STD1_VALUES),
	ID_AND_LENGTH(BICORN_SURFACE, 0),
	//
	ID_AND_LENGTH_C(PIRIFORM_SURFACE, 3, STD1_VALUES),
	ID_AND_LENGTH_C(KAPPA_SURFACE, 1, STD1_VALUES),
	ID_AND_LENGTH_C(BULLET_NOSE, 2, STD1_VALUES),
	ID_AND_LENGTH_C(SIEVERT_SURFACE, 1, STD1_VALUES),
	//
	ID_AND_LENGTH(COSINE_SURFACE2, 0),
	ID_AND_LENGTH_C(CYLINDER, 1, ALL_ONES),
	ID_AND_LENGTH_C(EPIZYKLOID_CYLINDER, 4, CYLINDER_VALUES),
	ID_AND_LENGTH_C(HYPOZYKLOID_CYLINDER, 4, CYLINDER_VALUES),
	//
	ID_AND_LENGTH_C(LEMNISKATE_CYLINDER, 2, ALL_ONES),
	ID_AND_LENGTH_C(STROPHOIDE_CYLINDER, 2, ALL_ONES),
	ID_AND_LENGTH_C(ZISSOIDE_CYLINDER, 2, ALL_ONES),
	ID_AND_LENGTH_C(VERSIERA_AGNESI_CYLINDER, 2, ALL_ONES),
	//
	ID_AND_LENGTH_C(GAUSS_CYLINDER, 3, ALL_ONES),
	//Fruits
	ID_AND_LENGTH(KIDNEY_SURFACE, 0),
	ID_AND_LENGTH(APPLE_SURFACE, 0),
	ID_AND_LENGTH_C(APPLE2_SURFACE, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(LEMON_SURFACE, 2, LEMON_VALUES),
	// Shells & snails
	ID_AND_LENGTH_C(CORNUCOPIA, 2, STD1_VALUES), // TODO
	ID_AND_LENGTH_C(SNAIL, 2, STD1_VALUES),		 // TODO
	ID_AND_LENGTH_C(SEASHELL, 4, STD1_VALUES),	 // TODO
	//
	ID_AND_LENGTH(SNAIL_SURFACE, 0),
	ID_AND_LENGTH_C(SNAILS, 7, STD1_VALUES),		// TODO
	ID_AND_LENGTH(PSEUDOHELICERAS_SUBCATENATUM, 0), // TODO R
	ID_AND_LENGTH(ASTROCERAS, 0),					// TODO R
	//
	ID_AND_LENGTH(BELLEROPHINA, 0),	   // TODO R
	ID_AND_LENGTH(EUHOPLITES, 0),	   // TODO R
	ID_AND_LENGTH(NAUTILUS, 0),		   // TODO R
	ID_AND_LENGTH(NATICA_STELLATA, 0), // TODO R
	//
	ID_AND_LENGTH(MYA_ARENARIA, 0), // TODO R
	// Sphere
	ID_AND_LENGTH(SPHERE, 0),
	ID_AND_LENGTH_C(ELLIPSOID, 3, SPHERE_VALUES),
	ID_AND_LENGTH(SPHERE_V, 0),
	//
	ID_AND_LENGTH(SPHERE_UV, 0),
	ID_AND_LENGTH(PSEUDOSPHERE, 0),
	ID_AND_LENGTH_C(TWISTED_SPHERE, 2, ALL_ONES),
	ID_AND_LENGTH(OPEN_SPHERE, 0),
	//
	ID_AND_LENGTH(WAVE_SPHERE, 0),
	// Spirals
	ID_AND_LENGTH_C(ARCHIMEDIC_SPIRAL, 1, ALL_ONES),
	ID_AND_LENGTH_C(HYPERBOLIC_SPIRAL, 1, ALL_ONES),
	ID_AND_LENGTH_C(FERMAT_SPIRAL, 1, ALL_ONES),
	//
	ID_AND_LENGTH_C(TANH_SPIRAL, 2, ALL_ONES),
	ID_AND_LENGTH_C(LOG_SPIRAL, 2, ALL_ONES),
	// Torus
	ID_AND_LENGTH_C(TORUS, 2, STD1_VALUES),
	ID_AND_LENGTH_C(EIGHT_TORUS, 1, ALL_ONES),
	//
	ID_AND_LENGTH_C(ELLIPTIC_TORUS, 1, ALL_ONES),
	ID_AND_LENGTH(SADDLE_TORUS, 0),
	ID_AND_LENGTH_C(ANTISYMMETRIC_TORUS, 3, STD1_VALUES),
	ID_AND_LENGTH_C(TWISTED_EIGHT_TORUS, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(UMBILLIC_TORUS, 2, STD1_VALUES),
	ID_AND_LENGTH_C(WAVE_TORUS, 4, STD1_VALUES),
	ID_AND_LENGTH_C(BRAIDED_TORUS, 4, ALL_ONES),
	ID_AND_LENGTH(LIMPET_TORUS, 0),
	//
	ID_AND_LENGTH_C(STRANGLED_TORUS, 3, ALL_ONES),
	ID_AND_LENGTH_C(ASTROID_TORUS, 2, ALL_ONES),
	ID_AND_LENGTH_C(TRICUSPOID_TORUS_1, 2, STD1_VALUES),
	ID_AND_LENGTH_C(TRICUSPOID_TORUS_2, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(NETHROID_TORUS_1, 2, STD1_VALUES),
	ID_AND_LENGTH_C(NETHROID_TORUS_2, 2, STD1_VALUES),
	ID_AND_LENGTH_C(LEMNISKATE_TORUS_1, 2, STD1_VALUES),
	ID_AND_LENGTH_C(LEMNISKATE_TORUS_2, 2, STD1_VALUES),
	//
	ID_AND_LENGTH_C(EPIZYKLOID_TORUS_1, 4, TORUS1_VALUES),
	ID_AND_LENGTH_C(EPIZYKLOID_TORUS_2, 4, TORUS1_VALUES),
	ID_AND_LENGTH_C(HYPOZYKLOID_TORUS_1, 4, TORUS1_VALUES),
	ID_AND_LENGTH_C(HYPOZYKLOID_TORUS_2, 4, TORUS1_VALUES),
	//
	ID_AND_LENGTH_C(PIRIFORM_TORUS_1, 2, ALL_ONES),
	ID_AND_LENGTH_C(PIRIFORM_TORUS_2, 2, ALL_ONES),
	ID_AND_LENGTH_C(BICORN_TORUS_1, 2, ALL_ONES),
	ID_AND_LENGTH_C(BICORN_TORUS_2, 2, ALL_ONES),
	//
	ID_AND_LENGTH_C(CARDIOID_TORUS_1, 2, ALL_ONES),
	ID_AND_LENGTH_C(CARDIOID_TORUS_2, 2, ALL_ONES),
	ID_AND_LENGTH_C(CASSINIAN_OVAL_TORUS_1, 3, ALL_ONES),
	ID_AND_LENGTH_C(CASSINIAN_OVAL_TORUS_2, 3, ALL_ONES),
	//
	ID_AND_LENGTH_C(GERONO_LEMNISKATE_TORUS_1, 2, ALL_ONES),
	ID_AND_LENGTH_C(GERONO_LEMNISKATE_TORUS_2, 2, ALL_ONES),
	ID_AND_LENGTH_C(CURLY_TORUS_1, 4, ALL_ONES),
	ID_AND_LENGTH_C(CURLY_TORUS_2, 4, ALL_ONES),
	//
	ID_AND_LENGTH_C(SPIRAL_TORUS, 4, ALL_ONES),
	ID_AND_LENGTH_C(TORUS_KNOT, 5, ALL_ONES),
	ID_AND_LENGTH_C(GEAR_TORUS, 4, ALL_ONES)
	// END
};

#include <stdio.h>

int findDefaultConstants(unsigned int id, double *pConstants, int size)
{
	unsigned int alreadyDefined =
		sizeof(id_and_length) / (3 * sizeof(char));

	printf("#defined = %d\n", alreadyDefined);

	if (id >= 255)
	{
		// Not found
		return -1;
	}

	for (size_t i = 0; i < alreadyDefined; i++)
	{
		int idInArray = id_and_length[i][0];
		if (id == idInArray)
		{
			int length = id_and_length[i][1];
			if (length > 0)
			{
				if (length < size)
				{
					// Not enough space to store
					return -2;
				}
				int typeOrValue = id_and_length[i][2];

				if (typeOrValue == ALL_ONES || typeOrValue == ALL_HALFES)
				{
					double v = typeOrValue == ALL_ONES ? 1.0 : 0.5;

					for (int j = 0; j < length; j++)
					{
						pConstants[j] = v;
					}
				}

				if (typeOrValue >= STD1_VALUES && typeOrValue <= TORUS1_VALUES)
				{
					int idx = (typeOrValue - STD1_VALUES) * 6;

					if (idx > sizeof(constants_multiplied) / sizeof(char) ||
						length > 6)
					{
						// INTERNAL error
						return -3;
					}

					for (int j = 0; j < length; j++)
					{
						pConstants[j] = (constants_multiplied[j] * 1.0) / 10.0;
					}
				}
				else
				{
					for (int j = 0; j < length; j++)
					{
						pConstants[j] = typeOrValue * 1.0;
					}
				}
			}
			return length;
		}
	}

	// Not found
	return -1;
}

#undef STD1_VALUES
#undef DINI_VALUES
#undef CYLINDER_VALUES
#undef LEMON_VALUES
#undef SPHERE_VALUES
#undef TORUS1_VALUES

#define PASULI_IMPLEMENTED(ID, IMPL_MASK) \
	{                                     \
		ID, IMPL_MASK                     \
	}

#define IMPL_POS 0x1
#define IMPL_UD 0x2
#define IMPL_VD 0x4
#define IMPL_N 0x8
#define IMPL_UUD 0x10
#define IMPL_UVD 0x20
#define IMPL_VVD 0x40
#define IMPL_ALL 0x7F
#define IMPL_ONLY_POS_UD_VD (IMPL_POS | IMPL_UD | IMPL_VD)
#define IMPL_NORMAL_BY_CROSS_PRODUCT 0x80
#define IMPL_NO_BEGIN_NORMAL IMPL_ONLY_POS_UD_VD | IMPL_NORMAL_BY_CROSS_PRODUCT

#define IMPL_NO_2DERIV 0x0F

#define IMPL_MINUS(ALL_VAL, TO_SUBTRACT) (ALL_VAL - (TO_SUBTRACT))

unsigned char implemented[][2] = {
	// Cylinder
	PASULI_IMPLEMENTED(CYLINDER, IMPL_ALL),
	PASULI_IMPLEMENTED(EPIZYKLOID_CYLINDER, IMPL_ALL),
	PASULI_IMPLEMENTED(GAUSS_CYLINDER, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(HYPOZYKLOID_CYLINDER, IMPL_ALL),
	PASULI_IMPLEMENTED(LEMNISKATE_CYLINDER, IMPL_MINUS(IMPL_ALL, IMPL_UUD)),
	PASULI_IMPLEMENTED(STROPHOIDE_CYLINDER, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(VERSIERA_AGNESI_CYLINDER, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(ZISSOIDE_CYLINDER, IMPL_NO_BEGIN_NORMAL),
	// Fruits
	PASULI_IMPLEMENTED(APPLE_SURFACE, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(APPLE2_SURFACE, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(KIDNEY_SURFACE, IMPL_ALL),
	PASULI_IMPLEMENTED(LEMON_SURFACE, IMPL_ALL),
	// Shells
	PASULI_IMPLEMENTED(CORNUCOPIA, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(SEASHELL, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(SNAIL_SURFACE, IMPL_ALL),
	PASULI_IMPLEMENTED(SNAIL, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(SNAILS, IMPL_NO_BEGIN_NORMAL),
	//Following Snails are special 'instances' of Snails
	PASULI_IMPLEMENTED(ASTROCERAS, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(BELLEROPHINA, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(EUHOPLITES, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(MYA_ARENARIA, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(NATICA_STELLATA, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(NAUTILUS, IMPL_NO_BEGIN_NORMAL),
	PASULI_IMPLEMENTED(PSEUDOHELICERAS_SUBCATENATUM, IMPL_NO_BEGIN_NORMAL),
	// Spheres
	PASULI_IMPLEMENTED(ELLIPSOID, IMPL_ALL),
	PASULI_IMPLEMENTED(OPEN_SPHERE, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(PSEUDOSPHERE, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(SPHERE_UV, IMPL_NO_2DERIV),
	PASULI_IMPLEMENTED(SPHERE_V, IMPL_ALL),
	PASULI_IMPLEMENTED(SPHERE, IMPL_ALL),
	PASULI_IMPLEMENTED(TWISTED_SPHERE, IMPL_ALL),
	PASULI_IMPLEMENTED(WAVE_SPHERE, IMPL_ALL),
	// Spirals
	PASULI_IMPLEMENTED(ARCHIMEDIC_SPIRAL, IMPL_ALL),
	PASULI_IMPLEMENTED(FERMAT_SPIRAL, IMPL_ALL),
	PASULI_IMPLEMENTED(HYPERBOLIC_SPIRAL, IMPL_ALL),
	PASULI_IMPLEMENTED(LOG_SPIRAL, IMPL_ALL),
	PASULI_IMPLEMENTED(TANH_SPIRAL, IMPL_NO_2DERIV),

};

#undef PASULI_IMPLEMENTED

int getImplementationState(unsigned int id)
{
	unsigned int alreadyImplemented =
		sizeof(implemented) / (2 * sizeof(char));

	printf("#implemented/checked = %d\n", alreadyImplemented);

	if (id >= 255)
	{
		// Not found
		return -1;
	}
	// TODO
	return 0;
}